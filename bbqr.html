<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>BBQr Generator</title>
  <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
  <link rel="shortcut icon" href="icon/favicon.ico">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'mono': ['SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', 'Consolas', 'Courier New', 'monospace'],
          },
          animation: {
            'pulse-subtle': 'pulse 1.5s ease-in-out infinite',
          }
        }
      }
    }
  </script>
  
  <style>
    /* Custom styles for elements that need specific behavior */
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-button-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-button-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .gradient-button-purple {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }
    
    .backdrop-blur-glass {
      backdrop-filter: blur(10px);
    }

    .file-type-badge {
      display: inline-block;
      padding: 4px 8px;
      background: #667eea;
      color: white;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 8px;
    }
  </style>
</head>
<body class="bg-white min-h-screen font-sans text-gray-900 transition-opacity duration-100">
  <!-- Main Container -->
  <div class="max-w-md md:max-w-2xl lg:max-w-4xl xl:max-w-5xl mx-auto bg-white 
              rounded-t-3xl md:rounded-3xl md:my-5 lg:my-8 
              overflow-hidden min-h-screen md:min-h-0 md:shadow-xl">
    
    <!-- Header with Gradient Background -->
    <div class="gradient-bg text-white relative rounded-b-3xl 
                px-6 py-16 md:px-12 md:py-20 lg:px-16 lg:py-24 text-center">
      
      <!-- Top Handle (Mobile) -->
      <div class="absolute top-3 left-1/2 transform -translate-x-1/2 
                  w-9 h-1.5 bg-white/30 rounded-full md:hidden"></div>
      
      <!-- Back Link -->
      <a href="/" 
         class="absolute top-5 left-6 md:left-12 lg:left-16 
                text-white/80 hover:text-white text-sm font-medium 
                flex items-center justify-center px-3 py-1.5 md:px-4 md:py-2 
                rounded-full bg-white/10 hover:bg-white/20 
                backdrop-blur-glass border border-white/20 
                transition-all duration-300 min-w-11 h-8 md:min-w-12 md:h-10"
         data-i18n="back">
        ←
      </a>
      
      <!-- Language Toggle -->
      <button class="language-toggle absolute top-5 right-6 md:right-12 lg:right-16 
                     bg-white/10 hover:bg-white/20 border border-white/20 
                     rounded-full px-3 py-1.5 md:px-4 md:py-2 
                     text-white/80 hover:text-white text-sm font-medium 
                     cursor-pointer transition-all duration-300 
                     backdrop-blur-glass min-w-11 h-8 md:min-w-12 md:h-10 
                     flex items-center justify-center" 
              onclick="toggleLanguage()">
        ENG
      </button>
      
      <!-- Title -->
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-2 tracking-tight" data-i18n="title">
        BBQr Generator
      </h1>
      <p class="text-white/85 text-sm md:text-base font-normal" data-i18n="subtitle">
        Bitcoin QR Code Encoding and Decoding Tool
      </p>
    </div>
    
    <!-- Content -->
    <div class="p-6 md:p-12 lg:p-16 bg-white space-y-8 md:space-y-12">
      
      <!-- Generate Section -->
      <div class="bg-white rounded-2xl md:rounded-3xl p-6 md:p-8 lg:p-10 
                  border border-gray-100 shadow-sm hover:shadow-md 
                  transition-all duration-300">
        <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-6 md:mb-8 tracking-tight" data-i18n="generateTitle">
          Generate BBQr Code
        </h2>
        
        <!-- Text Input -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-900 mb-2 tracking-tight" data-i18n="textInputLabel">
            Input Text or JSON Data
          </label>
          <textarea 
            id="text-input" 
            data-i18n-placeholder="textInputPlaceholder"
            placeholder="Enter any text, JSON or other data here..."
            class="w-full min-h-32 p-4 md:p-5 border-2 border-gray-100 
                   rounded-2xl text-base bg-gray-50/50 text-gray-900 
                   font-normal resize-y transition-all duration-300 
                   focus:outline-none focus:border-indigo-500 focus:bg-white 
                   focus:shadow-lg focus:-translate-y-0.5 focus:scale-101
                   placeholder-gray-400">
          </textarea>
        </div>
        
        <!-- File Input -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-900 mb-2 tracking-tight" data-i18n="fileInputLabel">
            Upload File
          </label>
          <input 
            type="file" 
            id="file-input" 
            accept=".psbt"
            class="w-full p-4 md:p-5 border-2 border-dashed border-gray-200 
                   rounded-2xl text-sm bg-gray-50/50 text-gray-900 cursor-pointer 
                   transition-all duration-300 hover:border-indigo-500 hover:bg-white
                   file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 
                   file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 
                   hover:file:bg-indigo-100">
        </div>
        
        <!-- Generate Button -->
        <div class="text-center">
          <button 
            id="generate-btn"
            class="gradient-button-primary text-white px-8 py-3 md:px-10 md:py-4 
                   rounded-xl md:rounded-2xl text-base font-semibold cursor-pointer 
                   transition-all duration-300 shadow-lg 
                   hover:-translate-y-0.5 hover:shadow-xl 
                   active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed 
                   disabled:transform-none disabled:shadow-lg min-w-32"
            data-i18n="generateBtn">
            Generate QR Code
          </button>
        </div>
        
        <!-- Output -->
        <div id="output" class="mt-6 text-center"></div>
      </div>

      <!-- Decode Section -->
      <div class="bg-white rounded-2xl md:rounded-3xl p-6 md:p-8 lg:p-10 
                  border border-gray-100 shadow-sm hover:shadow-md 
                  transition-all duration-300">
        <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-6 md:mb-8 tracking-tight" data-i18n="decodeTitle">
          Decode BBQr Code
        </h2>
        
        <!-- File Upload for Decoding -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-900 mb-2 tracking-tight" data-i18n="decodeInputLabel">
            Upload PNG Image Files
          </label>
          <input 
            type="file" 
            id="decode-input" 
            accept="image/png" 
            multiple
            class="w-full p-4 md:p-5 border-2 border-dashed border-gray-200 
                   rounded-2xl text-sm bg-gray-50/50 text-gray-900 cursor-pointer 
                   transition-all duration-300 hover:border-indigo-500 hover:bg-white
                   file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 
                   file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 
                   hover:file:bg-indigo-100">
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-col md:flex-row gap-3 md:gap-4 mb-6">
          <button 
            id="decode-btn"
            class="gradient-button-primary text-white px-6 py-3 md:px-8 md:py-4 
                   rounded-xl md:rounded-2xl text-base font-semibold cursor-pointer 
                   transition-all duration-300 shadow-lg 
                   hover:-translate-y-0.5 hover:shadow-xl 
                   active:translate-y-0 flex-1 min-w-32"
            data-i18n="decodeBtn">
            Decode PNG
          </button>
          <button 
            id="scan-btn"
            class="gradient-button-primary text-white px-6 py-3 md:px-8 md:py-4 
                   rounded-xl md:rounded-2xl text-base font-semibold cursor-pointer 
                   transition-all duration-300 shadow-lg 
                   hover:-translate-y-0.5 hover:shadow-xl 
                   active:translate-y-0 flex-1 min-w-32"
            data-i18n="scanBtn">
            Scan Camera
          </button>
          <button 
            id="copy-btn"
            class="bg-gray-100 hover:bg-gray-200 text-gray-900 px-6 py-3 md:px-8 md:py-4 
                   rounded-xl md:rounded-2xl text-base font-semibold cursor-pointer 
                   transition-all duration-300 shadow-lg 
                   hover:-translate-y-0.5 hover:shadow-xl 
                   active:translate-y-0 flex-1 min-w-32 hidden"
            data-i18n="copyBtn">
            Copy Result
          </button>
        </div>
        
        <!-- Camera Video -->
        <video 
          id="camera-video" 
          autoplay 
          playsinline 
          webkit-playsinline 
          muted
          class="w-full mt-4 border-2 border-gray-200 rounded-xl object-cover hidden">
        </video>
        
        <!-- Canvas for Camera -->
        <canvas id="camera-canvas" class="hidden"></canvas>
        
        <!-- Decode Output -->
        <div 
          id="decode-output"
          class="bg-gray-50/50 text-gray-900 p-4 rounded-xl 
                 whitespace-pre-wrap break-all font-mono text-sm leading-relaxed 
                 border border-gray-200 mt-4 min-h-16 hidden">
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
  <script src="./dist/bbqr.iife.js"></script>
  <script src="./dist/bbqr.bundle.js"></script>
  
  <script>
    // Language support
    const translations = {
      en: {
        title: 'BBQr Generator',
        subtitle: 'Bitcoin QR Code Encoding and Decoding Tool',
        back: '←',
        generateTitle: 'Generate BBQr Code',
        textInputLabel: 'Input Text or JSON Data',
        textInputPlaceholder: 'Enter any text, JSON or other data here...',
        fileInputLabel: 'Upload File',
        generateBtn: 'Generate QR Code',
        decodeTitle: 'Decode BBQr Code',
        decodeInputLabel: 'Upload PNG Image Files',
        decodeBtn: 'Decode PNG',
        scanBtn: 'Scan Camera',
        copyBtn: 'Copy Result',
        selectFiles: 'Select files or drag and drop'
      },
      zh: {
        title: 'BBQr 生成器',
        subtitle: '比特币 QR 码编码和解码工具',
        back: '←',
        generateTitle: '生成 BBQr 码',
        textInputLabel: '输入文本或JSON数据',
        textInputPlaceholder: '在此输入任意文本、JSON或其他数据...',
        fileInputLabel: '上传文件',
        generateBtn: '生成 QR 码',
        decodeTitle: '解码 BBQr 码',
        decodeInputLabel: '上传 PNG 图片文件',
        decodeBtn: '解码 PNG',
        scanBtn: '扫描相机',
        copyBtn: '复制结果',
        selectFiles: '选择文件或拖拽上传'
      }
    };

    let currentLanguage = localStorage.getItem('language') || 'en';

    function updateTexts() {
      const texts = translations[currentLanguage];
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (texts[key]) {
          element.textContent = texts[key];
        }
      });

      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (texts[key]) {
          element.placeholder = texts[key];
        }
      });

      const toggleBtn = document.querySelector('.language-toggle');
      if (toggleBtn) {
        toggleBtn.textContent = currentLanguage === 'en' ? '中文' : 'ENG';
      }

      document.documentElement.lang = currentLanguage;
    }

    function toggleLanguage() {
      currentLanguage = currentLanguage === 'en' ? 'zh' : 'en';
      localStorage.setItem('language', currentLanguage);
      updateTexts();
    }

    // Initialize language on page load
    updateTexts();

    // Enhanced status message display with Tailwind classes
    function showStatus(message, type = 'info') {
      const statusClasses = {
        success: 'bg-green-50 text-green-800 border-green-200',
        error: 'bg-red-50 text-red-800 border-red-200',
        info: 'bg-blue-50 text-blue-800 border-blue-200'
      };
      
      const statusDiv = document.createElement('div');
      statusDiv.className = `p-3 md:p-4 rounded-xl mt-4 text-sm font-medium border ${statusClasses[type]}`;
      statusDiv.textContent = message;
      
      // Add to output section
      const output = document.getElementById('output');
      const existingStatus = output.querySelector('.status-message');
      if (existingStatus) {
        existingStatus.remove();
      }
      statusDiv.classList.add('status-message');
      output.appendChild(statusDiv);
      
      // Auto-remove after 5 seconds for non-error messages
      if (type !== 'error') {
        setTimeout(() => {
          if (statusDiv.parentNode) {
            statusDiv.remove();
          }
        }, 5000);
      }
    }

    // Style QR code images with Tailwind classes
    function styleQRImages() {
      const images = document.querySelectorAll('#output img');
      images.forEach(img => {
        img.className = 'max-w-full rounded-xl shadow-lg mx-auto';
      });
    }

    // Show/hide elements with proper Tailwind classes
    function toggleElement(elementId, show) {
      const element = document.getElementById(elementId);
      if (element) {
        if (show) {
          element.classList.remove('hidden');
        } else {
          element.classList.add('hidden');
        }
      }
    }

    // Style decode output
    function styleDecodeOutput(content) {
      const output = document.getElementById('decode-output');
      if (output) {
        output.textContent = content;
        output.classList.remove('hidden');
      }
    }

    // Override the original functions to use our enhanced styling
    if (typeof window !== 'undefined') {
      // Observe DOM changes to apply styling
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            styleQRImages();
          }
        });
      });

      // Start observing
      observer.observe(document.getElementById('output'), {
        childList: true,
        subtree: true
      });
    }
  </script>
</body>
</html>
